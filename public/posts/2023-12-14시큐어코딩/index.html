<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #4d93fd;
        }
    </style>

    
    
    
    
    
    

    
    <title>aes() 무력화</title>
    <meta name="description" content="시큐어 코딩">
    <meta name="keywords" content='blog, gokarna, hugo, DKU, Security'>

    <meta property="og:url" content="http://localhost:1313/posts/2023-12-14%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="aes() 무력화">
    <meta property="og:description" content="시큐어 코딩">
    <meta property="og:image" content="http://localhost:1313/image/profile/MainCat.jpg">
    <meta property="og:image:secure_url" content="http://localhost:1313/image/profile/MainCat.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="aes() 무력화">
    <meta name="twitter:description" content="시큐어 코딩">
    <meta property="twitter:domain" content="http://localhost:1313/posts/2023-12-14%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
    <meta property="twitter:url" content="http://localhost:1313/posts/2023-12-14%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
    <meta name="twitter:image" content="http://localhost:1313/image/profile/MainCat.jpg">

    
    <link rel="canonical" href="http://localhost:1313/posts/2023-12-14%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
    <link rel='icon' type='image/png' href='http://localhost:1313/image/profile/favicon-16x16.png'>
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js" integrity="sha256-iTr43TtlvQ/&#43;kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script>

    
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="http://localhost:1313/">
                <img src='/image/profile/MainCat.jpg' alt="avatar">
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="http://localhost:1313/">Dyun&#39;s blog</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="http://localhost:1313/posts/"><span data-feather='pen-tool'></span> posts </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/projects/"><span data-feather='box'></span> projects </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/tags/"><span data-feather='hash'></span> tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/alsspp01"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target"></span>
                <a>
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="http://localhost:1313/posts/"><span data-feather='pen-tool'></span> posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/projects/"><span data-feather='box'></span> projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/tags/"><span data-feather='hash'></span> tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/alsspp01"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a>
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>aes() 무력화</h1>
        <small role="doc-subtitle">시큐어 코딩</small>
        <p class="post-date">December 14, 2023
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="http://localhost:1313/tags/dku">DKU</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/security">Security</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <h3 id="과제">과제</h3>
<p>간단한 암호함수에 user-defined aes-128 함수가 XOR 되어 있는 암호장치를 aes-128 암호 함수가 항상 16 byte 길이의 0으로 구성된 배열을 리턴시키도록 바이너리를 수정.<br>
비밀키는 column-oriented state로 정렬되어 있음.<br>
popen을 활용하여 원폰 파일을 호출하고 출력값을 읽어들일 것.<br>
출력값을 토대로 자신에게 부여된 비밀키를 역산하는 함수를 통해 분석 결과를 보여줄 것.</p>
<h3 id="풀이">풀이</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>.<span style="color:#f92672">/</span>sec_hw2		<span style="color:#75715e">// Permission Denied
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>chmod <span style="color:#ae81ff">777</span> .<span style="color:#f92672">/</span>sec_hw2	<span style="color:#75715e">// Permission 부여
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>file .<span style="color:#f92672">/</span>sec_hw2		<span style="color:#75715e">// ELF FILE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>objdump <span style="color:#f92672">-</span>M intel <span style="color:#f92672">-</span>d .<span style="color:#f92672">/</span>sec_hw2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">000000000004010</span>c8 <span style="color:#f92672">&lt;</span>aes<span style="color:#f92672">&gt;:</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">401208</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">98</span>			nop
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">401209</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">8</span>b <span style="color:#ae81ff">45</span> f8		mov rax, QWORD PTR [rbp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x8</span>]
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">40120</span>c: <span style="color:#ae81ff">64</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">33</span> <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">00</span>  	xor rax, QWORD PTR fs:<span style="color:#ae81ff">0x28</span>	<span style="color:#75715e">// rax에 결과값 저장
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">401214</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">401216</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">74</span> <span style="color:#ae81ff">05</span>			je <span style="color:#ae81ff">40121</span>d <span style="color:#f92672">&lt;</span>aes<span style="color:#f92672">+</span><span style="color:#ae81ff">0x155</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">401218</span><span style="color:#f92672">:</span> e8 <span style="color:#ae81ff">63</span> f4 ff ff		call <span style="color:#ae81ff">400680</span> <span style="color:#f92672">&lt;</span>__stack_chk_fail<span style="color:#960050;background-color:#1e0010">@</span>plt<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">40121</span>d: c9			leave
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">40121</span>e: c3			ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00000000000400720</span> <span style="color:#f92672">&lt;</span>.text<span style="color:#f92672">&gt;:</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">40135f</span><span style="color:#f92672">:</span> e8 <span style="color:#ae81ff">64</span> fd ff ff		call <span style="color:#ae81ff">4010</span>c8 <span style="color:#f92672">&lt;</span>aes<span style="color:#f92672">&gt;</span>		<span style="color:#75715e">// 4010c8 - 401364 = fffffd64(음수)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vim replace_zero.s		<span style="color:#75715e">// assembly code 작성
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	BITS 64
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	SECTION .text
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	global _start
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	_start:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	xor rax, rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	ret
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nasm <span style="color:#f92672">-</span>f bin <span style="color:#f92672">-</span>o replace_zero.bin replace_zero.s			<span style="color:#75715e">// assembly file -&gt; binary file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.<span style="color:#f92672">/</span>elfinject sec_hw2 replace_zero <span style="color:#e6db74">&#34;.injected&#34;</span> <span style="color:#ae81ff">0x800000</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>	<span style="color:#75715e">// binary inject
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>readelf <span style="color:#f92672">--</span>wide <span style="color:#f92672">-</span>S sec_hw2					<span style="color:#75715e">// [32] .injected PROGBITS Address:800780
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>hexedit sec_hw2
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	/E8 64 FD FF FF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	E8 1C F4 3F 00	// 800780 - 401364 = 3ff41c little endian
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>sec_hw2		<span style="color:#75715e">// &#34;a260c04c0bb8d0aec84ed95160db8e44&#34;
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">/*	decrypt.c	*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define ROTATE(T, A, B, C, D) {T=D; D=C; C=B; B=A; A=T;}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">GetInvSBox</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> TA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">char</span> buf[<span style="color:#ae81ff">256</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pos <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>	FILE <span style="color:#f92672">*</span>fp;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> state;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> conv_buf[<span style="color:#ae81ff">256</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">popen</span>(<span style="color:#e6db74">&#34;./sec_hw1&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> ( fp <span style="color:#f92672">==</span> NULL )
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">perror</span>(<span style="color:#e6db74">&#34;error: &#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> ( <span style="color:#a6e22e">fgets</span>(buf, <span style="color:#ae81ff">1024</span>, fp) <span style="color:#f92672">!=</span> NULL );
</span></span><span style="display:flex;"><span>	state <span style="color:#f92672">=</span> <span style="color:#a6e22e">pclose</span>(fp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	conv_buf[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtoul</span>(result, <span style="color:#f92672">&amp;</span>pos, <span style="color:#ae81ff">16</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%02X &#34;</span>, conv_buf[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> i ; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span> ; i <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		conv_buf[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtoul</span>(pos, <span style="color:#f92672">&amp;</span>pos, <span style="color:#ae81ff">16</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%02X &#34;</span>, conv_buf[i]);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*	Decrypting	*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// State2Vec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> conv_vec[<span style="color:#ae81ff">4</span>][<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> col <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; col <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; col <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> row <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; row <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; row <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>		conv_vec[row][col] <span style="color:#f92672">=</span> conv_buf[ col <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> row ];		<span style="color:#75715e">//column-oriented
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// SubBytes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> row <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; row <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; row <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> col <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; col <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; col <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>		con_vec[row][col] <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetInvSBox</span>(conv_vec[row][col]);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ShiftRows
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> T <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> row <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; row <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; row <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; i <span style="color:#f92672">&lt;</span> row ; i <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ROTATE</span>(T, conv_vec[row][<span style="color:#ae81ff">0</span>], conv_vec[row][<span style="color:#ae81ff">1</span>], conv_vec[row][<span style="color:#ae81ff">2</span>], conv_vec[row][<span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Vec2State
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> private_key[<span style="color:#ae81ff">16</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> col <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; col <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; col <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> row <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; row <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> ; row <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>		private_key[ col <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> row ] <span style="color:#f92672">=</span> conv_vec[row][col]; 		<span style="color:#75715e">// column-oriented
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// AddRoundKey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> plain_text <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0</span> ; plain_text <span style="color:#f92672">&lt;</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xf</span> ; plain_text <span style="color:#f92672">++</span> )
</span></span><span style="display:flex;"><span>		private_key[plain_text] <span style="color:#f92672">^=</span> plain_text;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">GetInvSBox</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> TA)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> invSbox[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//0     1    2      3     4    5     6     7      8    9     A      B    C     D     E     F
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">0x52</span>, <span style="color:#ae81ff">0x09</span>, <span style="color:#ae81ff">0x6a</span>, <span style="color:#ae81ff">0xd5</span>, <span style="color:#ae81ff">0x30</span>, <span style="color:#ae81ff">0x36</span>, <span style="color:#ae81ff">0xa5</span>, <span style="color:#ae81ff">0x38</span>, <span style="color:#ae81ff">0xbf</span>, <span style="color:#ae81ff">0x40</span>, <span style="color:#ae81ff">0xa3</span>, <span style="color:#ae81ff">0x9e</span>, <span style="color:#ae81ff">0x81</span>, <span style="color:#ae81ff">0xf3</span>, <span style="color:#ae81ff">0xd7</span>, <span style="color:#ae81ff">0xfb</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x7c</span>, <span style="color:#ae81ff">0xe3</span>, <span style="color:#ae81ff">0x39</span>, <span style="color:#ae81ff">0x82</span>, <span style="color:#ae81ff">0x9b</span>, <span style="color:#ae81ff">0x2f</span>, <span style="color:#ae81ff">0xff</span>, <span style="color:#ae81ff">0x87</span>, <span style="color:#ae81ff">0x34</span>, <span style="color:#ae81ff">0x8e</span>, <span style="color:#ae81ff">0x43</span>, <span style="color:#ae81ff">0x44</span>, <span style="color:#ae81ff">0xc4</span>, <span style="color:#ae81ff">0xde</span>, <span style="color:#ae81ff">0xe9</span>, <span style="color:#ae81ff">0xcb</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x54</span>, <span style="color:#ae81ff">0x7b</span>, <span style="color:#ae81ff">0x94</span>, <span style="color:#ae81ff">0x32</span>, <span style="color:#ae81ff">0xa6</span>, <span style="color:#ae81ff">0xc2</span>, <span style="color:#ae81ff">0x23</span>, <span style="color:#ae81ff">0x3d</span>, <span style="color:#ae81ff">0xee</span>, <span style="color:#ae81ff">0x4c</span>, <span style="color:#ae81ff">0x95</span>, <span style="color:#ae81ff">0x0b</span>, <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0xfa</span>, <span style="color:#ae81ff">0xc3</span>, <span style="color:#ae81ff">0x4e</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x08</span>, <span style="color:#ae81ff">0x2e</span>, <span style="color:#ae81ff">0xa1</span>, <span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x28</span>, <span style="color:#ae81ff">0xd9</span>, <span style="color:#ae81ff">0x24</span>, <span style="color:#ae81ff">0xb2</span>, <span style="color:#ae81ff">0x76</span>, <span style="color:#ae81ff">0x5b</span>, <span style="color:#ae81ff">0xa2</span>, <span style="color:#ae81ff">0x49</span>, <span style="color:#ae81ff">0x6d</span>, <span style="color:#ae81ff">0x8b</span>, <span style="color:#ae81ff">0xd1</span>, <span style="color:#ae81ff">0x25</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x72</span>, <span style="color:#ae81ff">0xf8</span>, <span style="color:#ae81ff">0xf6</span>, <span style="color:#ae81ff">0x64</span>, <span style="color:#ae81ff">0x86</span>, <span style="color:#ae81ff">0x68</span>, <span style="color:#ae81ff">0x98</span>, <span style="color:#ae81ff">0x16</span>, <span style="color:#ae81ff">0xd4</span>, <span style="color:#ae81ff">0xa4</span>, <span style="color:#ae81ff">0x5c</span>, <span style="color:#ae81ff">0xcc</span>, <span style="color:#ae81ff">0x5d</span>, <span style="color:#ae81ff">0x65</span>, <span style="color:#ae81ff">0xb6</span>, <span style="color:#ae81ff">0x92</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x6c</span>, <span style="color:#ae81ff">0x70</span>, <span style="color:#ae81ff">0x48</span>, <span style="color:#ae81ff">0x50</span>, <span style="color:#ae81ff">0xfd</span>, <span style="color:#ae81ff">0xed</span>, <span style="color:#ae81ff">0xb9</span>, <span style="color:#ae81ff">0xda</span>, <span style="color:#ae81ff">0x5e</span>, <span style="color:#ae81ff">0x15</span>, <span style="color:#ae81ff">0x46</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0xa7</span>, <span style="color:#ae81ff">0x8d</span>, <span style="color:#ae81ff">0x9d</span>, <span style="color:#ae81ff">0x84</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xd8</span>, <span style="color:#ae81ff">0xab</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x8c</span>, <span style="color:#ae81ff">0xbc</span>, <span style="color:#ae81ff">0xd3</span>, <span style="color:#ae81ff">0x0a</span>, <span style="color:#ae81ff">0xf7</span>, <span style="color:#ae81ff">0xe4</span>, <span style="color:#ae81ff">0x58</span>, <span style="color:#ae81ff">0x05</span>, <span style="color:#ae81ff">0xb8</span>, <span style="color:#ae81ff">0xb3</span>, <span style="color:#ae81ff">0x45</span>, <span style="color:#ae81ff">0x06</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0xd0</span>, <span style="color:#ae81ff">0x2c</span>, <span style="color:#ae81ff">0x1e</span>, <span style="color:#ae81ff">0x8f</span>, <span style="color:#ae81ff">0xca</span>, <span style="color:#ae81ff">0x3f</span>, <span style="color:#ae81ff">0x0f</span>, <span style="color:#ae81ff">0x02</span>, <span style="color:#ae81ff">0xc1</span>, <span style="color:#ae81ff">0xaf</span>, <span style="color:#ae81ff">0xbd</span>, <span style="color:#ae81ff">0x03</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x13</span>, <span style="color:#ae81ff">0x8a</span>, <span style="color:#ae81ff">0x6b</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x3a</span>, <span style="color:#ae81ff">0x91</span>, <span style="color:#ae81ff">0x11</span>, <span style="color:#ae81ff">0x41</span>, <span style="color:#ae81ff">0x4f</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0xdc</span>, <span style="color:#ae81ff">0xea</span>, <span style="color:#ae81ff">0x97</span>, <span style="color:#ae81ff">0xf2</span>, <span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0xce</span>, <span style="color:#ae81ff">0xf0</span>, <span style="color:#ae81ff">0xb4</span>, <span style="color:#ae81ff">0xe6</span>, <span style="color:#ae81ff">0x73</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x96</span>, <span style="color:#ae81ff">0xac</span>, <span style="color:#ae81ff">0x74</span>, <span style="color:#ae81ff">0x22</span>, <span style="color:#ae81ff">0xe7</span>, <span style="color:#ae81ff">0xad</span>, <span style="color:#ae81ff">0x35</span>, <span style="color:#ae81ff">0x85</span>, <span style="color:#ae81ff">0xe2</span>, <span style="color:#ae81ff">0xf9</span>, <span style="color:#ae81ff">0x37</span>, <span style="color:#ae81ff">0xe8</span>, <span style="color:#ae81ff">0x1c</span>, <span style="color:#ae81ff">0x75</span>, <span style="color:#ae81ff">0xdf</span>, <span style="color:#ae81ff">0x6e</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0xf1</span>, <span style="color:#ae81ff">0x1a</span>, <span style="color:#ae81ff">0x71</span>, <span style="color:#ae81ff">0x1d</span>, <span style="color:#ae81ff">0x29</span>, <span style="color:#ae81ff">0xc5</span>, <span style="color:#ae81ff">0x89</span>, <span style="color:#ae81ff">0x6f</span>, <span style="color:#ae81ff">0xb7</span>, <span style="color:#ae81ff">0x62</span>, <span style="color:#ae81ff">0x0e</span>, <span style="color:#ae81ff">0xaa</span>, <span style="color:#ae81ff">0x18</span>, <span style="color:#ae81ff">0xbe</span>, <span style="color:#ae81ff">0x1b</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0xfc</span>, <span style="color:#ae81ff">0x56</span>, <span style="color:#ae81ff">0x3e</span>, <span style="color:#ae81ff">0x4b</span>, <span style="color:#ae81ff">0xc6</span>, <span style="color:#ae81ff">0xd2</span>, <span style="color:#ae81ff">0x79</span>, <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0x9a</span>, <span style="color:#ae81ff">0xdb</span>, <span style="color:#ae81ff">0xc0</span>, <span style="color:#ae81ff">0xfe</span>, <span style="color:#ae81ff">0x78</span>, <span style="color:#ae81ff">0xcd</span>, <span style="color:#ae81ff">0x5a</span>, <span style="color:#ae81ff">0xf4</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0xdd</span>, <span style="color:#ae81ff">0xa8</span>, <span style="color:#ae81ff">0x33</span>, <span style="color:#ae81ff">0x88</span>, <span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0xc7</span>, <span style="color:#ae81ff">0x31</span>, <span style="color:#ae81ff">0xb1</span>, <span style="color:#ae81ff">0x12</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0x59</span>, <span style="color:#ae81ff">0x27</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xec</span>, <span style="color:#ae81ff">0x5f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x60</span>, <span style="color:#ae81ff">0x51</span>, <span style="color:#ae81ff">0x7f</span>, <span style="color:#ae81ff">0xa9</span>, <span style="color:#ae81ff">0x19</span>, <span style="color:#ae81ff">0xb5</span>, <span style="color:#ae81ff">0x4a</span>, <span style="color:#ae81ff">0x0d</span>, <span style="color:#ae81ff">0x2d</span>, <span style="color:#ae81ff">0xe5</span>, <span style="color:#ae81ff">0x7a</span>, <span style="color:#ae81ff">0x9f</span>, <span style="color:#ae81ff">0x93</span>, <span style="color:#ae81ff">0xc9</span>, <span style="color:#ae81ff">0x9c</span>, <span style="color:#ae81ff">0xef</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0xa0</span>, <span style="color:#ae81ff">0xe0</span>, <span style="color:#ae81ff">0x3b</span>, <span style="color:#ae81ff">0x4d</span>, <span style="color:#ae81ff">0xae</span>, <span style="color:#ae81ff">0x2a</span>, <span style="color:#ae81ff">0xf5</span>, <span style="color:#ae81ff">0xb0</span>, <span style="color:#ae81ff">0xc8</span>, <span style="color:#ae81ff">0xeb</span>, <span style="color:#ae81ff">0xbb</span>, <span style="color:#ae81ff">0x3c</span>, <span style="color:#ae81ff">0x83</span>, <span style="color:#ae81ff">0x53</span>, <span style="color:#ae81ff">0x99</span>, <span style="color:#ae81ff">0x61</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0x17</span>, <span style="color:#ae81ff">0x2b</span>, <span style="color:#ae81ff">0x04</span>, <span style="color:#ae81ff">0x7e</span>, <span style="color:#ae81ff">0xba</span>, <span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0xd6</span>, <span style="color:#ae81ff">0x26</span>, <span style="color:#ae81ff">0xe1</span>, <span style="color:#ae81ff">0x69</span>, <span style="color:#ae81ff">0x14</span>, <span style="color:#ae81ff">0x63</span>, <span style="color:#ae81ff">0x55</span>, <span style="color:#ae81ff">0x21</span>, <span style="color:#ae81ff">0x0c</span>, <span style="color:#ae81ff">0x7d</span>
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> invSbox[TA];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>/*	Test Result	*/
<img src="./image/DKU/sec2.png" alt="result"></p>
<h3 id="아쉬운-점">아쉬운 점</h3>
<p>aes 함수와 관련된 레지스터를 관찰하는 과정에서 동적으로 값이 변하며 암호값과 연관이 있어 보이는 레지스터를 발견했었지만 전체 동작에 영향을 주지 않고 hijacking할 방법을 찾지 못하여 기존의 방식대로 aes와 암호함수의 연결고리를 끊는 code injection으로 해결하였다.<br>
결국 답은 맞췄지만, 교수님 또한 출제 의도와 다른 풀이 방식이라고 말씀하셨다.<br>
기회가 있으면 바이너리 분석을 좀 더 공부해보면 좋을 것 같다.</p>

        
        <div class="post-comments">
            <div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'dyun'; 

  (function() {
    var dsq = document.createElement('script'); 
    dsq.type = 'text/javascript'; 
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.head || document.body).appendChild(dsq);
  })();
</script>


<script type="text/javascript">
  var disqus_shortname = 'dyun'; 
  (function() {
    var dsq = document.createElement('script'); 
    dsq.type = 'text/javascript'; 
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
    (document.head || document.body).appendChild(dsq);
  })();
</script>
        </div>
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/2023-11-21%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
            &#8592;
            Previous:
            rand() 무력화
        </a>
    </p>
    <p class="prev-post-date">
        November 21, 2023
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/2024-03-22%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
            Next:
            비밀번호 해킹
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            March 22, 2024
        </p>
</div>


            
        
    </div>

    
    
    <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top">
        
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
    </svg>
 <script>
    let backToTopButton = document.getElementById("btt-button");

    window.onscroll = function() {
        scrollFunction()
    };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            backToTopButton.style.display = "block";
        } else {
            backToTopButton.style.display = "none";
        }
    }

    function topFunction() {
        smoothScrollToTop();
    }

    function smoothScrollToTop() {
        const scrollToTop = () => {
            const c = document.documentElement.scrollTop || document.body.scrollTop;
            if (c > 0) {
                window.requestAnimationFrame(scrollToTop);
                window.scrollTo(0, 0);
            }
        };
        scrollToTop();
    }
</script>


    
    
</div>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2024 The Marauders</span>
    
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
