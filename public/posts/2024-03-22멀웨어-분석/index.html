<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #4d93fd;
        }
    </style>

    
    
    
    
    
    

    
    <title>비밀번호 해킹</title>
    <meta name="description" content="멀웨어 분석">
    <meta name="keywords" content='blog, gokarna, hugo, DKU, Security'>

    <meta property="og:url" content="http://localhost:1313/posts/2024-03-22%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="비밀번호 해킹">
    <meta property="og:description" content="멀웨어 분석">
    <meta property="og:image" content="http://localhost:1313/image/profile/MainCat.jpg">
    <meta property="og:image:secure_url" content="http://localhost:1313/image/profile/MainCat.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="비밀번호 해킹">
    <meta name="twitter:description" content="멀웨어 분석">
    <meta property="twitter:domain" content="http://localhost:1313/posts/2024-03-22%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
    <meta property="twitter:url" content="http://localhost:1313/posts/2024-03-22%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
    <meta name="twitter:image" content="http://localhost:1313/image/profile/MainCat.jpg">

    
    <link rel="canonical" href="http://localhost:1313/posts/2024-03-22%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
    <link rel='icon' type='image/png' href='http://localhost:1313/image/profile/favicon-16x16.png'>
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js" integrity="sha256-iTr43TtlvQ/&#43;kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script>

    
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="http://localhost:1313/">
                <img src='/image/profile/MainCat.jpg' alt="avatar">
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="http://localhost:1313/">Dyun&#39;s blog</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="http://localhost:1313/posts/"><span data-feather='pen-tool'></span> posts </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/projects/"><span data-feather='box'></span> projects </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/tags/"><span data-feather='hash'></span> tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/alsspp01"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target"></span>
                <a>
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="http://localhost:1313/posts/"><span data-feather='pen-tool'></span> posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/projects/"><span data-feather='box'></span> projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/tags/"><span data-feather='hash'></span> tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/alsspp01"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a>
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>비밀번호 해킹</h1>
        <small role="doc-subtitle">멀웨어 분석</small>
        <p class="post-date">March 22, 2024
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="http://localhost:1313/tags/dku">DKU</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/security">Security</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <h3 id="과제">과제</h3>
<p>crackme.exe를 olly debugger를 활용하여 바이너리 파일 분석 및 비밀번호를 추출</p>
<h3 id="풀이">풀이</h3>
<p><img src="./DKU/malware/media1/image1.png" alt="01"></p>
<p>우선 정보가 없기 때문에, 실행을 시켜보았다.</p>
<p>F8을 눌러 멈추는 곳에서 BP를 설정한다.</p>
<p><img src="./DKU/malware/media1/image2.png" alt="02"></p>
<p>F7을 눌러 들어간 후 F8을 눌러 멈추는 곳에 BP를 설정한다.</p>
<p><img src="./DKU/malware/media1/image3.png" alt="03">{width=&ldquo;6.268055555555556in&rdquo;
height=&ldquo;2.0506944444444444in&rdquo;}F7을 눌러 들어가 멈추는 곳에 BP
설정하였다.</p>
<p>주요 문자열이 있는 것으로 보아 main 함수와 관련된 것으로 보인다.</p>
<p><img src="./DKU/malware/media1/image4.png" alt="04"></p>
<p>결과 출력 직전 LOCAL.1과 LOCAL.2를 비교하는 걸로 보아 LOCAL.1과
LOCAL.2는 정답에 가깝다고 생각할 수 있다.</p>
<p>이에 scanf가 시작되는 지점까지 F7, BP 설정을 반복하였다.</p>
<p><img src="./DKU/malware/media1/image5.png" alt="05"></p>
<p><img src="./DKU/malware/media1/image6.png" alt="06"></p>
<p><img src="./DKU/malware/media1/image7.png" alt="07"></p>
<p>그 끝에 ZwReadFile을 call하는 것을 확인,</p>
<p><img src="./DKU/malware/media1/image8.png" alt="08"></p>
<p>함수로 돌아가는 것을 확인하고 바로 뒷부분에 BP 설정</p>
<p><img src="./DKU/malware/media1/image9.png" alt="09"></p>
<p><img src="./DKU/malware/media1/image10.png" alt="10"></p>
<p>레지스터를 관찰하며 입력한 값에 따라 레지스터가 어떻게 달라지는지
확인했을 때 해당 줄 이전까지는 입력 받은 값을 버퍼에 저장하고 비교를
위해 한 글자씩 가져오는 것으로 추측된다.</p>
<p><img src="./DKU/malware/media1/image11.png" alt="11"></p>
<p>CMP와 J* 문이 혼잡하게 있는 것으로 보아 여기에서 분기가 일어나고 있음을
알 수 있다.</p>
<p>BP 설정 후 비교하는 아스키코드 값을 대입해보며 추적해 나가 보았다.</p>
<p><img src="./DKU/malware/media1/image12.png" alt="12"></p>
<p>첫 번째 비교 분기 2D (-) 두 번째 비교 분기 2B(+)</p>
<p>이후는 넣었던 평문을 다시 꺼내는 과정으로 보인다.</p>
<p>2B가 더 뒤에서 검증을 받으니 2B(+)를 앞에 넣어보았다.</p>
<p><img src="./DKU/malware/media1/image13.png" alt="13"></p>
<p>아무래도 EBX에 다음 글자인 45(E)가 들어간 걸 보니 첫 글자는 +가 맞는 것
같다고 생각했는데 -에도 똑같이 적용된다.</p>
<p>-나 +가 들어가면 부호를 제거해주는 구문으로 추측된다.</p>
<p><img src="./DKU/malware/media1/image14.png" alt="14"></p>
<p>이 구문은 최상위 바이트 하나를 빼서 레지스터에 저장해주는 것으로
추측된다.</p>
<p><img src="./DKU/malware/media1/image15.png" alt="15"></p>
<p>이 구문은 숫자가 들어오지 않으면 0을 반환한다. 이후 분기문에 영향을
끼치는데, 이를 통해 password는 숫자임을 알 수 있다.</p>
<p><img src="./DKU/malware/media1/image16.png" alt="16"></p>
<p>문자열에 숫자가 있으면 다음 문자로 넘어가서 문자를 하나씩 저장하는
순회를 한다.</p>
<p>함수에 대한 정보는 더 이상 특별히 보이는 것이 없어 값을 대입해가며
LOCAL.1, LOCAL.2의 값 변화를 관찰해보았다.</p>
<p><img src="./DKU/malware/media1/image17.png" alt="17"></p>
<p>LOCAL.1에는 고정적으로 01232B14가 저장되어 있는데, 이는 0060FCD8에 있는
LOCAL.2의 값과 비교된다.</p>
<p>Ctrl + G를 hex창에 사용하여 0060FCD8 주소로 이동한 채로 F8을 눌러가며
어디에서 값이 변하는지 관찰해보았다.</p>
<p><img src="./DKU/malware/media1/image18.png" alt="18"></p>
<p><img src="./DKU/malware/media1/image19.png" alt="19"></p>
<p><img src="./DKU/malware/media1/image20.png" alt="20"></p>
<p>LOCAL.2는 arg1 순회를 한 바퀴 돌 때마다 갱신된다.</p>
<p>또한 위 구문에 의해 수가 한 번 더해지고 10(0Ah)이 곱해지는 것을
반복한다.</p>
<p>수를 더할 땐 ESI에 30을 빼고 ESI에 EBX를 더함으로써 EBX의 아스키코드가
30번대(숫자)임을 반영한 것을 알 수 있다.</p>
<p>이런 정보들을 통해 입력받은 문자열으로 10진수의 각 자릿수를 채우는
알고리즘으로 파악하고 LOCAL.1의 값을 10진수로 변환해보았다.</p>
<p>01232B14h = 19082004</p>
<p><img src="./DKU/malware/media1/image21.png" alt="21"></p>
<p>잘 작동된다.</p>

        
        <div class="post-comments">
            <div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'dyun'; 

  (function() {
    var dsq = document.createElement('script'); 
    dsq.type = 'text/javascript'; 
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.head || document.body).appendChild(dsq);
  })();
</script>


<script type="text/javascript">
  var disqus_shortname = 'dyun'; 
  (function() {
    var dsq = document.createElement('script'); 
    dsq.type = 'text/javascript'; 
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
    (document.head || document.body).appendChild(dsq);
  })();
</script>
        </div>
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/2023-12-14%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9/">
            &#8592;
            Previous:
            aes() 무력화
        </a>
    </p>
    <p class="prev-post-date">
        December 14, 2023
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/2024-03-31%EB%A9%80%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D/">
            Next:
            시리얼 넘버 해킹
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            March 31, 2024
        </p>
</div>


            
        
    </div>

    
    
    <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top">
        
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
    </svg>
 <script>
    let backToTopButton = document.getElementById("btt-button");

    window.onscroll = function() {
        scrollFunction()
    };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            backToTopButton.style.display = "block";
        } else {
            backToTopButton.style.display = "none";
        }
    }

    function topFunction() {
        smoothScrollToTop();
    }

    function smoothScrollToTop() {
        const scrollToTop = () => {
            const c = document.documentElement.scrollTop || document.body.scrollTop;
            if (c > 0) {
                window.requestAnimationFrame(scrollToTop);
                window.scrollTo(0, 0);
            }
        };
        scrollToTop();
    }
</script>


    
    
</div>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2024 The Marauders</span>
    
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
